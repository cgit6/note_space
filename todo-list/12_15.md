# 12/15 任務清單

## 處理事項

* [ ] 落地機制更新 `finishAct` -> `AddAct`
* [ ] 確認 mode 1 能正常運作

\[問題]
`hm := gmr.HitMapTmp()` 獲取的中獎符號索引值會包含 C1 符號的索引位置，在 `g.gravity()` 判斷是否要消除時， C1 被覆蓋為 0。
\[方案]
處理 `gravity()` 的時候，`for _, v := range hitmap` 多判斷一件事 `if screen[v] != 2` 排除掉 C1 符號 。

```go=
func (g *game1801) gravity(screen []int16, hitmap []int16, cols int, rows int, buf []int) []int16 {
	// 先把要消除的地方改0
	for _, v := range hitmap {
		// 排除掉 C1 符號
		if screen[v] != enum.SymbolTypeScatter {
			screen[v] = 0
		}
	}

    // 其他步驟省略
}
```

目前數值恢復正常

```cmd=
+----------------------------------------+
|              StormOfSeth               |
+--------------+-------------------------+
| Game Name    | StormOfSeth             |
| Game ID      | 1801                    |
| Total Rounds | 10                      |
| Total RTP    | 10,429.20 %             |
| RTP 95% CI   | [10,359.97%,10,498.43%] |
| Total Bet    | 20,000                  |
| Total Win    | 2,085,840               |
| Base Win     | 2,000,000               |
| Free Win     | 85,840                  |
| NoWin Rounds | 0                       |
| Trigger      | 10                      |
| STD          | 1.117                   |
| CV           | 0.011                   |
+--------------+-------------------------+
```

* [ ] 提交 Pull Request

## 調整內容

### Title

Improve game\_1801\_StormOfSeth handling

### Add a description

```md
## 調整內容

針對數值上限、輪帶表與掉落邏輯進行以下新增與調整：

* 新增「最高累計贏分值」判斷
* 新增設定檔中「特殊購買」的輪帶表，並在 Fixed 區塊補上對應權重值
* 新增 FG「累加總倍數上限值」為 51,000 倍，並在遊戲邏輯中實作上限判斷
* 調整 LUT 相關變數名稱，使其與實際轉存流程的語意一致
* 統一「生成盤面」與「補盤」使用同一組輪帶表
* 調整掉落消除邏輯，避免消除符號 C1
* 調整 getBaseResult、getFreeResult 的計算流程
* 修正 gravity() 重覆計算的行為，改為單次計算

## 測試

* 透過 debug 模式檢查相關數值是否符合預期
* 執行 make test-all，所有測試皆通過
```

## 待辦清單

* [ ] 添加輪帶

## 今日重點

* 提交機制更新 `AddAct()` 
* 系統更新 `exts` pool 改成單一 `ext` struct。